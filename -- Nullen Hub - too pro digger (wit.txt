pro Nullen command handler with whitelist players(other players can use commands if you .wl them)

local Players = game:GetService("Players")
local StarterGui = game:GetService("StarterGui")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TeleportService = game:GetService("TeleportService")
local TextChatService = game:GetService("TextChatService")

getgenv().LoveList = getgenv().LoveList or {}
getgenv().Configs = getgenv().Configs or {}
getgenv().Whitelisted = getgenv().Whitelisted or {[Players.LocalPlayer.Name] = true}
getgenv().FlingForce = getgenv().FlingForce or 1e9
getgenv().FlingSpin = getgenv().FlingSpin or 50
getgenv().FlingPower = getgenv().FlingPower or 2000
getgenv().FlySpeed = getgenv().FlySpeed or 85
getgenv().KissActive = getgenv().KissActive or false
getgenv().KissConn = getgenv().KissConn or nil
getgenv().KissBodyVel = getgenv().KissBodyVel or nil
getgenv().KissBodyGyro = getgenv().KissBodyGyro or nil
getgenv().KissOriginalWalkSpeed = getgenv().KissOriginalWalkSpeed or nil
getgenv().KissOriginalJumpPower = getgenv().KissOriginalJumpPower or nil
getgenv().FlingActive = getgenv().FlingActive or false

local Player = Players.LocalPlayer
local charRemovingConn, charAddedConn, lastRespawnPos
local StopVelConn
local VelocityThreshold = 600 -- studs/sec
local AntiVoidEnabled = false
local AntiVoidConn
local VOID_CHECK_Y = (Workspace and Workspace.FallenPartsDestroyHeight) or -100
local AntiFallDamageActive = false
local AntiFallDamageConns = {}
local Flying = false
local ctrl = {f=0, b=0, l=0, r=0, u=0, d=0}
local bv, bg, flyConn, hum
local SpinConn
local loopGotoConn
local NoDamageConn
local NoclipConn
local processedMessages = {}

-- === UTILITY FUNCTIONS ===
local function Message(title, text, duration)
    local success, err = pcall(function()
        StarterGui:SetCore("SendNotification", {Title = title, Text = text, Duration = duration or 3})
    end)
    if not success then
        print("[NullenHub Notification Failed] Title: " .. tostring(title) .. ", Text: " .. tostring(text) .. ", Error: " .. tostring(err))
    else
        print("[NullenHub Notification] Title: " .. tostring(title) .. ", Text: " .. tostring(text))
    end
end

local function FindPlayer(query)
    if not query then return end
    query = query:lower()
    for _, p in ipairs(Players:GetPlayers()) do
        if p.Name:lower():find(query) or p.DisplayName:lower():find(query) then
            return p
        end
    end
    return nil
end

local function safeDestroy(obj)
    if obj and typeof(obj) == "Instance" then
        pcall(function() obj:Destroy() end)
    end
end

local function getCharacterHumanoid()
    local char = Player.Character or Player.CharacterAdded:Wait()
    local root = char:FindFirstChild("HumanoidRootPart") or char:WaitForChild("HumanoidRootPart", 5)
    local hum = char:FindFirstChildOfClass("Humanoid") or char:WaitForChild("Humanoid", 5)
    return root, hum
end

-- === SUPPORTING FUNCTIONS ===
local function OpenTextbox()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "NullenHubTextbox"
    screenGui.Parent = game:GetService("CoreGui")
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 300, 0, 50)
    frame.Position = UDim2.new(0.5, -150, 0.1, 0)
    frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    frame.BorderSizePixel = 2
    frame.Parent = screenGui
    local textBox = Instance.new("TextBox")
    textBox.Size = UDim2.new(0.9, 0, 0.6, 0)
    textBox.Position = UDim2.new(0.05, 0, 0.2, 0)
    textBox.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    textBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    textBox.Text = ""
    textBox.PlaceholderText = "Enter command..."
    textBox.Parent = frame
    textBox.FocusLost:Connect(function(enterPressed)
        if enterPressed and textBox.Text ~= "" then
            HandleChat(Player, textBox.Text, true)
            textBox.Text = ""
        end
    end)
    Message("Textbox", "Textbox opened. Type commands here!", 2)
end

local function CloseTextbox()
    local screenGui = game:GetService("CoreGui"):FindFirstChild("NullenHubTextbox")
    if screenGui then
        screenGui:Destroy()
        Message("Textbox", "Textbox closed.", 2)
    else
        Message("Textbox", "No textbox found to close.", 2)
    end
end

local function StopVelocity(duration)
    if StopVelConn then StopVelConn:Disconnect() end
    local root, hum = getCharacterHumanoid()
    if not root or not hum then
        Message("StopVel", "No character found.", 2)
        return
    end
    StopVelConn = RunService.Heartbeat:Connect(function()
        pcall(function()
            root.Velocity = Vector3.new(0, 0, 0)
            if root.AssemblyLinearVelocity then
                root.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
            end
        end)
    end)
    task.spawn(function()
        task.wait(duration)
        if StopVelConn then
            StopVelConn:Disconnect()
            StopVelConn = nil
        end
    end)
end

local function CancelStopVelocity()
    if StopVelConn then
        StopVelConn:Disconnect()
        StopVelConn = nil
        Message("StopVel", "Cancelled velocity stop.", 2)
    else
        Message("StopVel", "No active velocity stop to cancel.", 2)
    end
end

local function CollectConfig()
    return {
        FlingForce = getgenv().FlingForce,
        FlingSpin = getgenv().FlingSpin,
        FlingPower = getgenv().FlingPower,
        FlySpeed = getgenv().FlySpeed,
        LoveList = getgenv().LoveList,
        Whitelisted = getgenv().Whitelisted
    }
end

local function ApplyConfig(cfg)
    if cfg.FlingForce then getgenv().FlingForce = cfg.FlingForce end
    if cfg.FlingSpin then getgenv().FlingSpin = cfg.FlingSpin end
    if cfg.FlingPower then getgenv().FlingPower = cfg.FlingPower end
    if cfg.FlySpeed then getgenv().FlySpeed = cfg.FlySpeed end
    if cfg.LoveList then getgenv().LoveList = cfg.LoveList end
    if cfg.Whitelisted then getgenv().Whitelisted = cfg.Whitelisted end
end

local function SkidFlingWithSafeReturn(target)
    local char = Player.Character
    if not char or not char.PrimaryPart then
        Message("Fling", "No character found.", 2)
        return
    end
    local root = char.PrimaryPart
    local originalPos = root.CFrame

    local targetChar = target.Character
    if not targetChar or not targetChar.PrimaryPart then
        Message("Fling", "Target character not found.", 2)
        return
    end
    local targetRoot = targetChar.PrimaryPart
    local targetHum = targetChar:FindFirstChildOfClass("Humanoid")
    if not targetHum then
        Message("Fling", "Target humanoid not found.", 2)
        return
    end

    -- Instantly teleport to target ONCE before starting fling
    root.CFrame = targetRoot.CFrame * CFrame.new(0, 0, 2)

    -- Create fling physics
    local bv = Instance.new("BodyVelocity")
    bv.MaxForce = Vector3.new(getgenv().FlingForce, getgenv().FlingForce, getgenv().FlingForce)
    bv.P = getgenv().FlingPower
    bv.Velocity = Vector3.new(0, 0, 0)
    bv.Parent = root

    local bav = Instance.new("BodyAngularVelocity")
    bav.MaxTorque = Vector3.new(getgenv().FlingForce, getgenv().FlingForce, getgenv().FlingForce)
    bav.AngularVelocity = Vector3.new(getgenv().FlingSpin, getgenv().FlingSpin, getgenv().FlingSpin)
    bav.Parent = root

    getgenv().FlingActive = true

    local conn
    conn = RunService.Heartbeat:Connect(function()
        if not getgenv().FlingActive or not target or not target.Parent then
            bv:Destroy(); bav:Destroy(); conn:Disconnect(); return
        end

        if targetHum.Health <= 0 or targetRoot.Velocity.Magnitude > VelocityThreshold then
            getgenv().FlingActive = false
        end

        bav.AngularVelocity = Vector3.new(getgenv().FlingSpin, getgenv().FlingSpin, getgenv().FlingSpin)

        -- ORIGINAL TWEEN-LIKE FLING LOGIC
        local predictionTime = math.clamp(targetRoot.Velocity.Magnitude / 200, 0.1, 0.5)
        local predictedPos = targetRoot.Position + targetRoot.Velocity * predictionTime
        local offset = targetHum.MoveDirection.Magnitude > 0 and targetHum.MoveDirection.Unit * 3 or Vector3.new(0, 0, 0)
        local direction = (predictedPos + offset - root.Position).Unit
        bv.Velocity = direction * getgenv().FlingPower
    end)

    -- SAFE RETURN: teleport back gradually until velocity is near zero
    spawn(function()
        repeat task.wait(0.03) until not getgenv().FlingActive

        if root and root.Parent then
            local VELOCITY_THRESHOLD = 5 -- studs/sec, considered "stopped"
            while root.Parent and root.AssemblyLinearVelocity.Magnitude > VELOCITY_THRESHOLD do
                pcall(function()
                    root.CFrame = originalPos
                    root.Velocity = Vector3.new(0, 0, 0)
                end)
                task.wait(0.03)
            end
        end

        bv:Destroy()
        bav:Destroy()
        if conn then conn:Disconnect() end
    end)
end

local function StartWalkFling()
    local root, hum = getCharacterHumanoid()
    if not root or not hum then
        Message("WalkFling", "No character found.", 2)
        return
    end
    getgenv().FlingActive = true
    local bv = Instance.new("BodyVelocity")
    bv.MaxForce = Vector3.new(math.huge, 0, math.huge)
    bv.Velocity = Vector3.new(0, 0, 0)
    bv.Parent = root
    local spin = Instance.new("BodyAngularVelocity")
    spin.MaxTorque = Vector3.new(0, getgenv().FlingSpin, 0)
    spin.AngularVelocity = Vector3.new(0, getgenv().FlingForce, 0)
    spin.Parent = root
end

local function StopWalkFling()
    getgenv().FlingActive = false
    local root = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if root then
        for _, v in ipairs(root:GetChildren()) do
            if v:IsA("BodyVelocity") or v:IsA("BodyAngularVelocity") then
                safeDestroy(v)
            end
        end
    end
end

local function EnableInstaRespawn()
    if charAddedConn then charAddedConn:Disconnect() end
    if charRemovingConn then charRemovingConn:Disconnect() end
    local root, hum = getCharacterHumanoid()
    if not root or not hum then
        Message("InstaRespawn", "No character found.", 2)
        return
    end
    lastRespawnPos = root.CFrame
    charRemovingConn = Player.CharacterRemoving:Connect(function()
        lastRespawnPos = root.CFrame
    end)
    charAddedConn = Player.CharacterAdded:Connect(function(char)
        local newRoot = char:WaitForChild("HumanoidRootPart", 5)
        if newRoot and lastRespawnPos then
            task.wait(0.1)
            pcall(function() newRoot.CFrame = lastRespawnPos end)
        end
    end)
    Message("InstaRespawn", "Enabled instant respawn.", 2)
end

local function DisableInstaRespawn()
    if charRemovingConn then charRemovingConn:Disconnect() end
    if charAddedConn then charAddedConn:Disconnect() end
    charRemovingConn = nil
    charAddedConn = nil
    lastRespawnPos = nil
    Message("InstaRespawn", "Disabled instant respawn.", 2)
end

local function startAntiVoid()
    if AntiVoidConn then return end
    AntiVoidConn = RunService.Heartbeat:Connect(function()
        local char = Player.Character
        if not char then return end
        local hrp = char:FindFirstChild("HumanoidRootPart")
        if not hrp then return end
        local y = hrp.Position.Y
        local velY = 0
        pcall(function() velY = hrp.AssemblyLinearVelocity and hrp.AssemblyLinearVelocity.Y or (hrp.Velocity and hrp.Velocity.Y) or 0 end)
        if y > (VOID_CHECK_Y + 10) and velY > -80 then
            lastSafeCFrame = hrp.CFrame
        end
        if y <= VOID_CHECK_Y + 1 then
            local rayOrigin = hrp.Position + Vector3.new(0, 100, 0)
            local rayDir = Vector3.new(0, -5000, 0)
            local params = RaycastParams.new()
            params.FilterDescendantsInstances = {char}
            params.FilterType = Enum.RaycastFilterType.Blacklist
            local result = workspace:Raycast(rayOrigin, rayDir, params)
            if result and result.Position then
                local targetCFrame = CFrame.new(result.Position + Vector3.new(0, 5, 0))
                pcall(function() hrp.CFrame = targetCFrame end)
            elseif lastSafeCFrame then
                pcall(function() hrp.CFrame = lastSafeCFrame end)
            else
                local spawn = workspace:FindFirstChildOfClass("SpawnLocation") or workspace:FindFirstChild("SpawnLocation")
                if spawn and spawn:IsA("BasePart") then
                    pcall(function() hrp.CFrame = spawn.CFrame + Vector3.new(0, 5, 0) end)
                end
            end
            task.wait(0.2)
        end
    end)
end

local function stopAntiVoid()
    if AntiVoidConn then
        AntiVoidConn:Disconnect()
        AntiVoidConn = nil
    end
end

function EnableAntiVoid()
    if AntiVoidEnabled then
        Message("AntiVoid", "Anti-void already enabled.", 2)
        return
    end
    AntiVoidEnabled = true
    VOID_CHECK_Y = (workspace and workspace.FallenPartsDestroyHeight) or -100
    startAntiVoid()
    Message("AntiVoid", "Enabled anti-void rescue.", 2)
end

function DisableAntiVoid()
    if not AntiVoidEnabled then
        Message("AntiVoid", "Anti-void already disabled.", 2)
        return
    end
    AntiVoidEnabled = false
    stopAntiVoid()
    Message("AntiVoid", "Disabled anti-void rescue.", 2)
end

local function EnableAntiFallDamage()
    if AntiFallDamageConns[1] then AntiFallDamageConns[1]:Disconnect() end
    if AntiFallDamageConns[2] then AntiFallDamageConns[2]:Disconnect() end
    AntiFallDamageActive = true
    local root, hum = getCharacterHumanoid()
    if not root or not hum then
        Message("AntiFallDamage", "No character found.", 2)
        return
    end
    AntiFallDamageConns[1] = hum.StateChanged:Connect(function(old, new)
        if new == Enum.HumanoidStateType.FallingDown or new == Enum.HumanoidStateType.Ragdoll then
            hum:ChangeState(Enum.HumanoidStateType.Running)
        end
    end)
    AntiFallDamageConns[2] = RunService.Heartbeat:Connect(function()
        if root.Velocity.Magnitude > VelocityThreshold then
            pcall(function()
                root.Velocity = Vector3.new(root.Velocity.X, math.clamp(root.Velocity.Y, -100, 100), root.Velocity.Z)
                if root.AssemblyLinearVelocity then
                    root.AssemblyLinearVelocity = Vector3.new(root.Velocity.X, math.clamp(root.Velocity.Y, -100, 100), root.Velocity.Z)
                end
            end)
        end
    end)
    Message("AntiFallDamage", "Enabled anti-fall damage.", 2)
end

local function DisableAntiFallDamage()
    for _, conn in ipairs(AntiFallDamageConns) do
        if conn then conn:Disconnect() end
    end
    AntiFallDamageConns = {}
    AntiFallDamageActive = false
    Message("AntiFallDamage", "Disabled anti-fall damage.", 2)
end

local function EnableNoDamage()
    if NoDamageConn then NoDamageConn:Disconnect() end
    local hum = Player.Character and Player.Character:FindFirstChildOfClass("Humanoid")
    if not hum then
        Message("NoDamage", "No humanoid found.", 2)
        return
    end
    NoDamageConn = hum:GetPropertyChangedSignal("Health"):Connect(function()
        pcall(function() hum.Health = hum.MaxHealth end)
    end)
    Message("NoDamage", "Enabled no damage.", 2)
end

local function DisableNoDamage()
    if NoDamageConn then NoDamageConn:Disconnect() end
    NoDamageConn = nil
    Message("NoDamage", "Disabled no damage.", 2)
end

UserInputService.InputBegan:Connect(function(input, processed)
    if processed then return end
    local kc = input.KeyCode
    if kc == Enum.KeyCode.W then ctrl.f = 1 end
    if kc == Enum.KeyCode.S then ctrl.b = 1 end
    if kc == Enum.KeyCode.A then ctrl.l = 1 end
    if kc == Enum.KeyCode.D then ctrl.r = 1 end
    if kc == Enum.KeyCode.Space then ctrl.u = 1 end
    if kc == Enum.KeyCode.E then ctrl.d = 1 end
end)

UserInputService.InputEnded:Connect(function(input)
    local kc = input.KeyCode
    if kc == Enum.KeyCode.W then ctrl.f = 0 end
    if kc == Enum.KeyCode.S then ctrl.b = 0 end
    if kc == Enum.KeyCode.A then ctrl.l = 0 end
    if kc == Enum.KeyCode.D then ctrl.r = 0 end
    if kc == Enum.KeyCode.Space then ctrl.u = 0 end
    if kc == Enum.KeyCode.E then ctrl.d = 0 end
end)

function StartFly(speed)
    if Flying then
        Message("Fly", "Already flying.", 2)
        return
    end
    Flying = true
    getgenv().FlySpeed = tonumber(speed) or getgenv().FlySpeed or 85
    local hrp, curHum = getCharacterHumanoid()
    hum = curHum
    if not hrp or not hum then
        Flying = false
        Message("Fly", "No character found.", 2)
        return
    end
    hum.PlatformStand = true
    safeDestroy(bv); safeDestroy(bg)
    if flyConn then flyConn:Disconnect() end
    bv = Instance.new("BodyVelocity")
    bv.MaxForce = Vector3.new(1e6, 1e6, 1e6)
    bv.Velocity = Vector3.new(0, 0, 0)
    bv.Parent = hrp
    bg = Instance.new("BodyGyro")
    bg.MaxTorque = Vector3.new(9e5, 9e5, 9e5)
    bg.CFrame = hrp.CFrame
    bg.Parent = hrp
    flyConn = RunService.RenderStepped:Connect(function()
        if not Flying then return end
        local move = Vector3.new(ctrl.r - ctrl.l, ctrl.u - ctrl.d, ctrl.b - ctrl.f)
        if move.Magnitude > 0 then
            local cam = Workspace.CurrentCamera
            bv.Velocity = cam.CFrame:VectorToWorldSpace(move.Unit * (getgenv().FlySpeed or 85))
        else
            bv.Velocity = Vector3.new(0, 0, 0)
        end
        bg.CFrame = Workspace.CurrentCamera.CFrame
    end)
    Message("Fly", "Enabled fly.", 2)
end

function StopFly()
    if flyConn then flyConn:Disconnect() flyConn = nil end
    safeDestroy(bv); safeDestroy(bg); bv = nil; bg = nil
    local char = Player.Character
    if char then
        local currentHum = char:FindFirstChildOfClass("Humanoid")
        if currentHum then currentHum.PlatformStand = false end
    end
    hum = nil
    Flying = false
    ctrl = {f = 0, b = 0, l = 0, r = 0, u = 0, d = 0}
    Message("Fly", "Disabled fly.", 2)
end

function EnableSpin(speed)
    if SpinConn then
        Message("Spin", "Already spinning.", 2)
        return
    end
    speed = tonumber(speed) or 10
    SpinConn = RunService.Heartbeat:Connect(function()
        if Player.Character and Player.Character:FindFirstChild("HumanoidRootPart") then
            Player.Character.HumanoidRootPart.CFrame = Player.Character.HumanoidRootPart.CFrame * CFrame.Angles(0, math.rad(speed), 0)
        end
    end)
    Message("Spin", "Spinning enabled.", 2)
end

function DisableSpin()
    if SpinConn then
        SpinConn:Disconnect()
        SpinConn = nil
        Message("Spin", "Spinning disabled.", 2)
    else
        Message("Spin", "Not spinning.", 2)
    end
end

local function LoopGoto(target)
    if loopGotoConn then loopGotoConn:Disconnect() end
    local root = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if not root or not target.Character or not target.Character:FindFirstChild("HumanoidRootPart") then
        Message("LoopGoto", "No character or target found.", 2)
        return
    end
    loopGotoConn = RunService.Heartbeat:Connect(function()
        if target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
            pcall(function()
                root.CFrame = target.Character.HumanoidRootPart.CFrame + Vector3.new(0, 3, 0)
            end)
        else
            loopGotoConn:Disconnect()
            loopGotoConn = nil
        end
    end)
end

local function StopLoopGoto()
    if loopGotoConn then
        loopGotoConn:Disconnect()
        loopGotoConn = nil
        Message("LoopGoto", "Stopped loopgoto.", 2)
    else
        Message("LoopGoto", "No active loopgoto to stop.", 2)
    end
end

local function EnableNoclip()
    if NoclipConn then
        Message("Noclip", "Noclip already enabled.", 2)
        return
    end
    NoclipConn = RunService.Stepped:Connect(function()
        local char = Player.Character
        if char then
            for _, part in ipairs(char:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = false
                end
            end
        end
    end)
    Message("Noclip", "Enabled noclip.", 2)
end

local function DisableNoclip()
    if NoclipConn then
        NoclipConn:Disconnect()
        NoclipConn = nil
        Message("Noclip", "Disabled noclip.", 2)
    else
        Message("Noclip", "Noclip already disabled.", 2)
    end
end

local function CmdStatus()
    local status = {
        "FlingActive: " .. tostring(getgenv().FlingActive),
        "KissActive: " .. tostring(getgenv().KissActive),
        "AntiVoid: " .. tostring(AntiVoidEnabled),
        "AntiFallDamage: " .. tostring(AntiFallDamageActive),
        "Flying: " .. tostring(Flying)
    }
    Message("CmdStatus", table.concat(status, ", "), 5)
end

local function FlingStatus()
    Message("FlingStatus", "Force: " .. getgenv().FlingForce .. ", Spin: " .. getgenv().FlingSpin .. ", Power: " .. getgenv().FlingPower, 5)
end

local function SendIYCommand(cmd)
    -- Placeholder for Infinite Yield compatibility
end

-- === CHAT HANDLER ===
function HandleChat(p, msg, showNotifications)
    if not p or not msg then return end

    -- Deduplicate messages using a simple key
    local messageKey = tostring(p.UserId) .. ":" .. msg
    if processedMessages[messageKey] then return end
    processedMessages[messageKey] = true
    spawn(function()
        task.wait(2)
        processedMessages[messageKey] = nil
    end)

    -- Only process messages starting with "." for command checks
    if msg:sub(1, 1) == "." then
        -- Show permission denied for non-whitelisted players (except local player)
        if not getgenv().Whitelisted[p.Name] and p ~= Player then
            Message("Nullen Hub", "You do not have permission to use this command.", 3)
            return
        end
    else
        -- Non-command messages from non-whitelisted players are ignored
        if not getgenv().Whitelisted[p.Name] and p ~= Player then
            return
        end
    end

    -- Process commands for whitelisted players or local player
    msg = msg:lower()
    local args = {}
    for word in msg:gmatch("%S+") do table.insert(args, word) end
    local cmd = args[1]

    if cmd == ".textbox" then
        OpenTextbox()
        return
    end
    if cmd == ".untextbox" then
        CloseTextbox()
        return
    end

    if cmd == ".join" and args[2] then
        local input = args[2]:gsub("%s+", "")
        local placeId = tonumber(input:match("placeId=(%d+)") or input:match("https?://www%.roblox%.com/games/(%d+)"))
        local jobId = input:match("gameInstanceId=([%w%-]+)") or input:match("jobId=([%w%-]+)")
        if placeId and jobId then
            pcall(function() TeleportService:TeleportToPlaceInstance(placeId, jobId, Player) end)
            Message("Join", "Teleporting to Job " .. jobId, 3)
        else
            Message("Join", "Invalid link format! Use roblox://placeId=123&gameInstanceId=abc", 5)
        end
        return
    end

    if cmd == ".stopvel" or cmd == ".stopvelocity" or cmd == ".breakvelocity" or cmd == ".0velocity" then
        local dur = tonumber(args[2]) or 0.7
        StopVelocity(dur)
        Message("StopVel", "Stopped velocity for " .. tostring(dur) .. "s.", 2)
        return
    end
    if cmd == ".cancelvel" then
        CancelStopVelocity()
        return
    end

    if cmd == ".config" and args[2] then
        local name = args[2]:lower()
        local cfg = getgenv().Configs[name]
        if not cfg and type(getclipboard) == "function" then
            local text = getclipboard and getclipboard() or ""
            local success, loaded = pcall(function() return game:GetService("HttpService"):JSONDecode(text:match("return%s+(.+)")) end)
            if success and loaded then
                cfg = loaded
                getgenv().Configs[name] = cfg
                Message("Config", "Config '" .. name .. "' loaded from clipboard!", 3)
            end
        end
        if cfg then
            ApplyConfig(cfg)
            Message("Config", "Config '" .. name .. "' applied!", 3)
        else
            Message("Config", "Config '" .. name .. "' not found!", 2)
        end
        return
    end

    if cmd == ".love" and args[2] then
        local target = FindPlayer(args[2])
        if target then
            getgenv().LoveList[target.Name:lower()] = true
            Message("Love", target.DisplayName .. " added to your LoveList â¤ï¸", 3)
        else
            Message("Love", "Player '" .. args[2] .. "' not found!", 3)
        end
        return
    end

    if cmd == ".unlove" and args[2] then
        local target = FindPlayer(args[2])
        local name = args[2]:lower()
        if getgenv().LoveList[name] then
            getgenv().LoveList[name] = nil
            Message("Love", (target and target.DisplayName or name) .. " removed from your LoveList ðŸ’”", 3)
        else
            Message("Love", "Player '" .. name .. "' is not in your LoveList!", 3)
        end
        return
    end

    if cmd == ".kiss" then
        if p == Player then
            Message("Love", "You can't kiss yourself!", 2)
            return
        end
        if getgenv().KissActive then
            Message("Love", "Kiss already active!", 2)
            return
        end
        local myChar = Player.Character
        local theirChar = p.Character
        if myChar and theirChar then
            local myRoot = myChar:FindFirstChild("HumanoidRootPart")
            local theirRoot = theirChar:FindFirstChild("HumanoidRootPart")
            local myHum = myChar:FindFirstChildOfClass("Humanoid")
            if myRoot and theirRoot and myHum then
                getgenv().KissActive = true
                if getgenv().KissConn then
                    getgenv().KissConn:Disconnect()
                    getgenv().KissConn = nil
                end
                getgenv().KissOriginalWalkSpeed = myHum.WalkSpeed
                getgenv().KissOriginalJumpPower = myHum.JumpPower
                local originalAnchored = myRoot.Anchored
                local kissStartTime = tick()
                local kissDuration = 1.66
                local moveDuration = 0.5
                local initialWait = 0.2
                myHum.WalkSpeed = 0
                myHum.JumpPower = 0
                local targetCFrame = theirRoot.CFrame
                local startPos = targetCFrame * CFrame.new(0, 0, -2.2)
                local closePos = targetCFrame * CFrame.new(0, 0, -1.2)
                local lookAtCFrame = CFrame.new(startPos.Position, targetCFrame.Position)
                pcall(function()
                    myRoot.Anchored = true
                    myRoot.CFrame = lookAtCFrame
                    task.wait(0.05)
                    myRoot.Anchored = originalAnchored
                end)
                getgenv().KissBodyVel = Instance.new("BodyVelocity")
                getgenv().KissBodyVel.MaxForce = Vector3.new(1e6, 1e6, 1e6)
                getgenv().KissBodyVel.Velocity = Vector3.new(0, 0, 0)
                getgenv().KissBodyVel.Parent = myRoot
                getgenv().KissBodyGyro = Instance.new("BodyGyro")
                getgenv().KissBodyGyro.MaxTorque = Vector3.new(math.huge, math.huge, math.huge)
                getgenv().KissBodyGyro.P = 20000
                getgenv().KissBodyGyro.D = 2000
                getgenv().KissBodyGyro.Parent = myRoot
                getgenv().KissConn = RunService.Heartbeat:Connect(function()
                    if not getgenv().KissActive or not theirChar or not theirChar.Parent or not theirRoot or not theirRoot.Parent then
                        if getgenv().KissConn then
                            getgenv().KissConn:Disconnect()
                            getgenv().KissConn = nil
                        end
                        if myRoot and myRoot.Parent then
                            pcall(function()
                                safeDestroy(getgenv().KissBodyVel)
                                safeDestroy(getgenv().KissBodyGyro)
                                getgenv().KissBodyVel = nil
                                getgenv().KissBodyGyro = nil
                                myHum.WalkSpeed = getgenv().KissOriginalWalkSpeed or 16
                                myHum.JumpPower = getgenv().KissOriginalJumpPower or 50
                                myRoot.Velocity = Vector3.new(0, 0, 0)
                                if myRoot.AssemblyLinearVelocity then
                                    myRoot.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
                                end
                                getgenv().KissActive = false
                                getgenv().KissOriginalWalkSpeed = nil
                                getgenv().KissOriginalJumpPower = nil
                            end)
                        end
                        Message("Love", "Kiss ended! ðŸ’‹", 2)
                        getgenv().KissActive = false
                        return
                    end
                    local elapsed = tick() - kissStartTime
                    if elapsed > kissDuration then
                        if getgenv().KissConn then
                            getgenv().KissConn:Disconnect()
                            getgenv().KissConn = nil
                        end
                        if myRoot and myRoot.Parent then
                            pcall(function()
                                safeDestroy(getgenv().KissBodyVel)
                                safeDestroy(getgenv().KissBodyGyro)
                                getgenv().KissBodyVel = nil
                                getgenv().KissBodyGyro = nil
                                myHum.WalkSpeed = getgenv().KissOriginalWalkSpeed or 16
                                myHum.JumpPower = getgenv().KissOriginalJumpPower or 50
                                myRoot.Velocity = Vector3.new(0, 0, 0)
                                if myRoot.AssemblyLinearVelocity then
                                    myRoot.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
                                end
                                getgenv().KissActive = false
                                getgenv().KissOriginalWalkSpeed = nil
                                getgenv().KissOriginalJumpPower = nil
                            end)
                        end
                        Message("Love", "Kiss ended! ðŸ’‹", 2)
                        getgenv().KissActive = false
                        return
                    end
                    local targetCFrame = theirRoot.CFrame
                    local startPos = targetCFrame * CFrame.new(0, 0, -2.2)
                    local closePos = targetCFrame * CFrame.new(0, 0, -1.2)
                    local currentPos
                    if elapsed < initialWait then
                        currentPos = startPos
                    elseif elapsed < initialWait + moveDuration then
                        local t = (elapsed - initialWait) / moveDuration
                        currentPos = startPos:Lerp(closePos, t)
                    elseif elapsed < initialWait + 2 * moveDuration then
                        local t = (elapsed - initialWait - moveDuration) / moveDuration
                        currentPos = closePos:Lerp(startPos, t)
                    else
                        currentPos = startPos
                    end
                    local lookAtCFrame = CFrame.new(currentPos.Position, targetCFrame.Position)
                    pcall(function()
                        myRoot.CFrame = lookAtCFrame
                        getgenv().KissBodyGyro.CFrame = lookAtCFrame
                        myRoot.Velocity = Vector3.new(0, 0, 0)
                        if myRoot.AssemblyLinearVelocity then
                            myRoot.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
                        end
                    end)
                end)
                Message("Love", p.DisplayName .. " kissed you! ðŸ’‹ðŸ˜˜", 3)
            else
                Message("Love", "Missing character parts!", 2)
                getgenv().KissActive = false
            end
        else
            Message("Love", "Character not found!", 2)
            getgenv().KissActive = false
        end
        return
    end

    if cmd == ".unkiss" then
        if getgenv().KissConn then
            getgenv().KissConn:Disconnect()
            getgenv().KissConn = nil
        end
        local myChar = Player.Character
        if myChar then
            local myRoot = myChar:FindFirstChild("HumanoidRootPart")
            local myHum = myChar:FindFirstChildOfClass("Humanoid")
            if myRoot and myHum then
                pcall(function()
                    safeDestroy(getgenv().KissBodyVel)
                    safeDestroy(getgenv().KissBodyGyro)
                    getgenv().KissBodyVel = nil
                    getgenv().KissBodyGyro = nil
                    myHum.WalkSpeed = getgenv().KissOriginalWalkSpeed or 16
                    myHum.JumpPower = getgenv().KissOriginalJumpPower or 50
                    myHum.PlatformStand = false
                    myRoot.Anchored = false
                    myRoot.Velocity = Vector3.new(0, 0, 0)
                    if myRoot.AssemblyLinearVelocity then
                        myRoot.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
                    end
                    getgenv().KissActive = false
                    getgenv().KissOriginalWalkSpeed = nil
                    getgenv().KissOriginalJumpPower = nil
                end)
                Message("Love", "Kiss stopped! ðŸ’”", 2)
            else
                Message("Love", "No character found to stop kiss.", 2)
            end
        else
            Message("Love", "No character found to stop kiss.", 2)
        end
        getgenv().KissActive = false
        return
    end

    if cmd == ".punish" then
        local myHum = Player.Character and Player.Character:FindFirstChildOfClass("Humanoid")
        if myHum then
            myHum.Health = 0
            Message("Love", p.DisplayName .. " playfully punished you! ðŸ’¥", 3)
        else
            Message("Love", "Couldn't reset (no humanoid found).", 2)
        end
        return
    end

    if cmd == ".cmdstatus" then
        CmdStatus()
        return
    end
    if cmd == ".flingstatus" then
        FlingStatus()
        return
    end

    if cmd == ".createconfig" and args[2] then
        local name = args[2]:lower()
        local cfg = CollectConfig()
        getgenv().Configs[name] = cfg
        if type(setclipboard) == "function" then
            setclipboard("return " .. game:GetService("HttpService"):JSONEncode(cfg))
            Message("Config", "Config '" .. name .. "' saved and copied to clipboard!", 3)
        else
            Message("Config", "Config '" .. name .. "' saved locally!", 3)
        end
        return
    end

    if cmd == ".listconfigs" then
        local names = {}
        for k in pairs(getgenv().Configs) do table.insert(names, k) end
        Message("Configs", "Configs: " .. table.concat(names, ", "), 5)
        return
    end

    if cmd == ".antivoid" then
        EnableAntiVoid()
        return
    end
    if cmd == ".unantivoid" then
        DisableAntiVoid()
        return
    end

    if cmd == ".antifalldamage" then
        EnableAntiFallDamage()
        return
    end
    if cmd == ".unantifalldamage" then
        DisableAntiFallDamage()
        return
    end

    if cmd == ".fling" and args[2] then
        local targetName = args[2]
        local target
        if targetName == "all" then
            local flungCount = 0
            for _, plr in ipairs(Players:GetPlayers()) do
                if plr ~= Player then 
                    SkidFlingWithSafeReturn(plr)
                    flungCount = flungCount + 1
                end
            end
            Message("Fling", "Flung " .. flungCount .. " players.", 2)
        elseif targetName == "random" then
            local list = {}
            for _, plr in ipairs(Players:GetPlayers()) do 
                if plr ~= Player then table.insert(list, plr) end 
            end
            target = list[math.random(#list)]
            if target then 
                SkidFlingWithSafeReturn(target)
                Message("Fling", "Flung random player: " .. target.DisplayName, 2)
            else
                Message("Fling", "No valid players found.", 2)
            end
        else
            target = FindPlayer(targetName)
            if target then 
                SkidFlingWithSafeReturn(target)
                Message("Fling", "Flung " .. target.DisplayName, 2)
            else
                Message("Fling", "Target '" .. targetName .. "' not found.", 2)
            end
        end
        return
    elseif cmd == ".unfling" then
        getgenv().FlingActive = false
        Message("Fling", "Fling stopped.", 2)
        return
    end

    if cmd == ".flingforce" and args[2] then
        getgenv().FlingForce = tonumber(args[2])
        Message("FlingForce", "Set to " .. getgenv().FlingForce, 2)
        return
    end
    if cmd == ".flingspin" and args[2] then
        getgenv().FlingSpin = tonumber(args[2])
        Message("FlingSpin", "Set to " .. getgenv().FlingSpin, 2)
        return
    end
    if cmd == ".flingpower" and args[2] then
        getgenv().FlingPower = tonumber(args[2])
        Message("FlingPower", "Set to " .. getgenv().FlingPower, 2)
        return
    end

    if cmd == ".walkfling" then
        StartWalkFling()
        Message("WalkFling", "Started walk fling.", 2)
        SendIYCommand(";walkfling")
        return
    end
    if cmd == ".unwalkfling" then
        StopWalkFling()
        Message("WalkFling", "Stopped walk fling.", 2)
        SendIYCommand(";unwalkfling")
        return
    end

    if cmd == ".instarespawn" then
        EnableInstaRespawn()
        return
    end
    if cmd == ".uninstarespawn" then
        DisableInstaRespawn()
        return
    end

    if cmd == ".fov" and args[2] then
        local fov = tonumber(args[2])
        if fov then
            Workspace.CurrentCamera.FieldOfView = fov
            Message("FOV", "Set to " .. fov, 2)
        else
            Message("FOV", "Invalid FOV value.", 2)
        end
        return
    end

    if cmd == ".nodamage" then
        EnableNoDamage()
        return
    end
    if cmd == ".damage" then
        DisableNoDamage()
        return
    end

    if cmd == ".wl" and args[2] then
        if args[2] == "all" then
            for _, plr in ipairs(Players:GetPlayers()) do
                getgenv().Whitelisted[plr.Name] = true
            end
            Message("Whitelist", "All players whitelisted.", 2)
        else
            local found = false
            for _, plr in ipairs(Players:GetPlayers()) do
                if plr.Name:lower():find(args[2]:lower()) or plr.DisplayName:lower():find(args[2]:lower()) then
                    getgenv().Whitelisted[plr.Name] = true
                    Message("Whitelist", "Whitelisted " .. plr.DisplayName, 2)
                    found = true
                end
            end
            if not found then
                Message("Whitelist", "No players found matching '" .. args[2] .. "'.", 2)
            end
        end
        return
    elseif cmd == ".unwl" and args[2] then
        if args[2]:lower() == "all" then
            local localPlayerName = Player.Name
            local clearedCount = 0
            for name, _ in pairs(getgenv().Whitelisted) do
                if name ~= localPlayerName then
                    getgenv().Whitelisted[name] = nil
                    clearedCount = clearedCount + 1
                end
            end
            Message("Whitelist", "Cleared " .. clearedCount .. " players from whitelist (kept local player).", 2)
        else
            local found = false
            for _, plr in ipairs(Players:GetPlayers()) do
                if plr.Name:lower():find(args[2]:lower()) or plr.DisplayName:lower():find(args[2]:lower()) then
                    if plr.Name ~= Player.Name then
                        getgenv().Whitelisted[plr.Name] = nil
                        Message("Whitelist", "Removed " .. plr.DisplayName, 2)
                        found = true
                    else
                        Message("Whitelist", "Cannot unwhitelist yourself!", 2)
                    end
                end
            end
            if not found then
                Message("Whitelist", "No players found matching '" .. args[2] .. "'.", 2)
            end
        end
        return
    end

    if cmd == ".listwl" then
        local wl = {}
        for name, _ in pairs(getgenv().Whitelisted) do table.insert(wl, name) end
        Message("Whitelist", "Whitelisted: " .. table.concat(wl, ", "), 5)
        return
    end

    if (cmd == ".jumppower" or cmd == ".jp") and args[2] then
        local hum = Player.Character and Player.Character:FindFirstChildOfClass("Humanoid")
        local jp = tonumber(args[2])
        if hum then
            if jp then
                hum.UseJumpPower = true
                hum.JumpPower = jp
                Message("JumpPower", "Set to " .. jp, 2)
            else
                Message("JumpPower", "Invalid jump power value.", 2)
            end
        else
            Message("JumpPower", "No humanoid found.", 2)
        end
        return
    end

    if cmd == ".fly" then
        StartFly(tonumber(args[2]) or 85)
        return
    end
    if cmd == ".unfly" then
        StopFly()
        return
    end
    if cmd == ".speed" and args[2] then
        local val = tonumber(args[2])
        local hum = Player.Character and Player.Character:FindFirstChildOfClass("Humanoid")
        if hum then
            if val then
                hum.WalkSpeed = val
                Message("Speed", "Set to " .. val, 2)
            else
                Message("Speed", "Invalid speed value.", 2)
            end
        else
            Message("Speed", "No humanoid found.", 2)
        end
        return
    end

    if cmd == ".spin" then
        EnableSpin(args[2])
        return
    end
    if cmd == ".unspin" then
        DisableSpin()
        return
    end

    if cmd == ".loopgoto" and args[2] then
        local target = FindPlayer(args[2])
        if target then
            LoopGoto(target)
            Message("LoopGoto", "Looping to " .. target.DisplayName, 2)
        else
            Message("LoopGoto", "Player '" .. args[2] .. "' not found.", 2)
        end
        return
    elseif cmd == ".unloopgoto" then
        StopLoopGoto()
        return
    end

    if cmd == ".noclip" then
        EnableNoclip()
        return
    end
    if cmd == ".clip" then
        DisableNoclip()
        return
    end

    if cmd == ".goto" and args[2] then
        local target = FindPlayer(args[2])
        if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
            local myRoot = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
            if myRoot then
                myRoot.CFrame = target.Character.HumanoidRootPart.CFrame + Vector3.new(0, 3, 0)
                Message("Goto", "Teleported to " .. target.DisplayName, 2)
            else
                Message("Goto", "Your character not found.", 2)
            end
        else
            Message("Goto", "Player '" .. args[2] .. "' not found or no character.", 2)
        end
        return
    end

    if cmd == ".tptool" then
        local mouse = Player:GetMouse()
        if not mouse then
            Message("TP Tool", "Mouse not available. Your executor may not support this feature.", 3)
            return
        end
        local tool = Instance.new("Tool")
        tool.RequiresHandle = false
        tool.Name = "TP Tool (Click TP)"
        tool.Activated:Connect(function()
            local pos = mouse.Hit + Vector3.new(0, 2.5, 0)
            local myRoot = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
            if myRoot then
                myRoot.CFrame = CFrame.new(pos.X, pos.Y, pos.Z)
                Message("TP Tool", "Teleported to mouse position.", 2)
            else
                Message("TP Tool", "Your character not found.", 2)
            end
        end)
        tool.Parent = Player.Backpack
        Message("TP Tool", "Added to backpack.", 2)
        return
    end
end

-- === CHAT HOOK FUNCTION ===
local function HookChat()
    local function hookPlayer(p)
        p.Chatted:Connect(function(msg)
            HandleChat(p, msg)
        end)
    end

    -- hook existing players
    for _, p in ipairs(Players:GetPlayers()) do
        hookPlayer(p)
    end

    -- hook players that join later
    Players.PlayerAdded:Connect(function(p)
        hookPlayer(p)
    end)

    Message("Nullen Hub", "Best command handler made by mankind up and working.", 3)
end

HookChat()



